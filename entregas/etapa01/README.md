## Entrada da ETAPA 01 - Convers√£o inicial

Nesta etapa apenas foram sanitizados os arquios XML originais (pasta [recebidoOriginal](../recebidoOriginal)) e convertidos para XML correto, em UTF-8 e com conte√∫dos em texto (n√£o `CDATA`).

## Opera√ß√µes realizadas

1. Sanitiza√ß√£o: foi necess√°ria apenas convers√£o de `&` em `&amp;` no arquio original `TCC.xml` (linha 81 em "CNPq 308162/2014-5 & CAPES"). <br/>Revis√£o manual (remo√ß√£o do bug), [*commit* `b89a8d`](https://github.com/ppKrauss/SBPqO-2019/commit/b89a8d9050485e14b6f779ea4baeea83368e207b).

2. Convers√£o de enconding: foi necess√°ria uma etapa de convers√£o padr√£o do *XML enconding* original "iso-8859-1" para "UTF-8". Tecnicamente Tecnicamente a convers√£o fica mais simples se no mesmo processo os blocos `CDATA` forem expandidos para texto (e tratando eventuais tags HTML como texto).  Todo o processo pode ser reproduzido rodando-se o script `proc.php etapa1a`, conforme dump abaixo  que resultou no  [*commit* `38bb45`](https://github.com/ppKrauss/SBPqO-2019/commit/38bb45096ebcba986c5363bd77c449c262ecb5de).

    2.1. Convers√£o "iso-8859-1" para "UTF-8"

    2.2. Expans√£o dos blocos `CDATA` conforme [padr√£o SimpleXML do PHP](https://www.php.net/manual/en/book.simplexml.php) e seu uso no script.

3. Coners√£o de texto-cru para XHTML: o texto CDATA para que se seja aceito como XML n√£o pode ter confus√£o entre sinais `>`, `<`, ou `&` e tags XML. Nesta etapa foram reinterpretados os sinais e convertidos em tags quando consistentes. As entidades num√©ricas tamb√©m foram convertidas em caracteres UTF-8. Todo o processo pode ser reproduzido rodando-se o script `proc.php etapa1b`.

     3.1. Convers√£o em tag. [*Commit* `8260d2`](https://github.com/ppKrauss/SBPqO-2019/commit/8260d2b65a091d3c63d0027a51e7ebb28c0c8610).

     3.2. Acerto manual das tags desbalanceadas. [*Commit* `8a02d4`](https://github.com/ppKrauss/SBPqO-2019/commit/8a02d4287da6cc057b5babffa0acd459767e44eb).
     
     3.3. Corre√ß√£o do [bug03](https://github.com/ppKrauss/SBPqO-2019/issues/3) (n√£o foi adotado UTF-8 can√¥nico/NFC no XML original), e convers√£o das entidades num√©ricas em s√≠mbolos. Ver Etapa 01c,  [*commit* `294027`](https://github.com/ppKrauss/SBPqO-2019/commit/294027b677744f979d216efd5976115ef143c0c1).

## Resumo das regras de convers√£o corretivas da Etapa 01c
Regras relativas a 
* corre√ß√£o do  [bug03](https://github.com/ppKrauss/SBPqO-2019/issues/3) dos diacr√≠licos;
* bugs relativos a "sujeiras de edi√ß√£o" dos autores (ex. uso do caracter 64257 "&#64257;" no lugar da s√≠laba "fi");
* normaliza√ß√µes (por exemplo padronizando o uso do Delta "Œî" do alabeto grego ao inv√©s de "‚àÜ" ou "‚ñ≥"); 

foram aplicadas automaticamente ou iterativamente com  [`src/proc.php`](https://github.com/ppKrauss/SBPqO-2019/blob/294027b677744f979d216efd5976115ef143c0c1/src/proc.php#L117). Abaixo um resumo extra√≠do do c√≥digo.

```
// diacr√≠licos para acentos do portugues vigente:
	'c&#807;'=>"√ß",    'C&#807;'=>"√á", 
	'a&#771;'=>"√£", 'o&#771;'=>"√µ",  'A&#771;'=>"√É", 'O&#771;'=>"√ï",
	'a&#769;'=>"√°", 'e&#769;'=>"√©", 'i&#769;'=>"√≠", 'o&#769;'=>"√≥", 'u&#769;'=>"√∫",
	'A&#769;'=>"√Å", 'E&#769;'=>"√â", 'I&#769;'=>"√ç", 'O&#769;'=>"√ì", 'U&#769;'=>"√ö", 
	'a&#770;'=>"√¢", 'e&#770;'=>"√™", 'o&#770;'=>"√¥",
	'a&#768;'=>"√†",
// diacr√≠licos para nomes estrangeiros:
	'o&#776;'=>"√∂", 'u&#776;'=>"√º", // ex. Gr√∂dig and M√ºller
// ("&#8315;¬≤" == "‚Åª¬≤") dual para conveter caracter invalido 8315 em maca SUP: 
	'&#8315;¬π'=>"<sup>-1</sup>", '&#8315;¬≤'=>"<sup>-2</sup>", '&#8315;¬≥'=>"<sup>-3</sup>",
	'&#8315;‚Å¥'=>"<sup>-8</sup>", '&#8315;‚Å∏'=>"<sup>-4</sup>",
// ("&#713;¬π" == 'Àâ¬π') dual para conveter caracter invalido 713 em maca SUP: "&#8315;¬≤" == "‚Åª¬≤"
	'&#713;¬π'=>"<sup>-1</sup>", '&#713;¬≤'=>"<sup>-2</sup>", '&#713;¬≥'=>"<sup>-3</sup>", // sup ISO 
	'&#713;‚Å¥'=>"<sup>-8</sup>", '&#713;‚Å∏'=>"<sup>-4</sup>", 
  // PS: numerais ISO e n√£o-ISO (4 a 9) tamb√©m devem ser convertidos em sup.
// Translitera√ß√£o dos especiais inv√°lidos para equivalentes corretos:
	'∆û'=>'Œ∑', '…ë'=>'Œ±', '‚àÜ' =>'Œî', '‚ç∫'  =>'Œ±', 'ùúé'=>'œÉ', '‚ñ≥'=>'Œî', //  greek normalization
	'‚àï'=>'√∑', 'Àê'=>':', 'ƒ∏'=>'Œ∫', '‚Äê'=>'-', '≈ç'=>'√µ', 'ƒÅ'=>'√£', '∆õ'=>'Œª','Õæ'=>';', // etc. normalization
	'ÀÇ'=>'&lt;', 'ÀÉ'=>'&gt;', // expand to entity
	'¬π'=>"<sup>1</sup>", '¬≤'=>"<sup>2</sup>", '¬≥'=>"<sup>3</sup>", // ISO expand to tag
	'ùëù'=>"<i>p</i>", '‚Å¥'=>"<sup>8</sup>", '‚Å∏'=>"<sup>4</sup>",     // non-ISO to tag
// Prezavados:
	// gregos de 900 a 1000
	// demais selecionados:
	// 351,730,8733,8773,8776,8800,8804,8722,8805, // bons
	// 8729,1178,1008, //  revisar esses
// Convertidos para espa√ßo:  8232
// Convertidos para NBSP (165): 8195,8201,8202,59154,61617
// Deletados: 8203,8206
```

------


## Dumps

Registro de mensagens de sa√≠da do terminal e evid√™ncia de teste dos procedimentos autom√°ticos ou semi-autom√°ticos.

### Dump da Etapa 01a
Realizados os itens 2.1 e 2.2 descritos acima.

```
php src/proc.php etapa01a

-- etapa01a - Lendo XMLs originais, conferindo e gravando como UTF8 -- 
-- /home/user/sandbox/xmlWks/SBPqO-2019/recebidoOriginal/AO.xml -- AO0001 .. AO0240
-- /home/user/sandbox/xmlWks/SBPqO-2019/recebidoOriginal/COL.xml --COL001
-- /home/user/sandbox/xmlWks/SBPqO-2019/recebidoOriginal/FC.xml --FC001
-- /home/user/sandbox/xmlWks/SBPqO-2019/recebidoOriginal/HA.xml --HA001
-- /home/user/sandbox/xmlWks/SBPqO-2019/recebidoOriginal/JL.xml --JL001
-- /home/user/sandbox/xmlWks/SBPqO-2019/recebidoOriginal/PDI.xml --PDI001
-- /home/user/sandbox/xmlWks/SBPqO-2019/recebidoOriginal/PE.xml --PE001
-- /home/user/sandbox/xmlWks/SBPqO-2019/recebidoOriginal/PI.xml --PI0001
-- /home/user/sandbox/xmlWks/SBPqO-2019/recebidoOriginal/PN.xml --PN0001
-- /home/user/sandbox/xmlWks/SBPqO-2019/recebidoOriginal/PO.xml --PO001
-- /home/user/sandbox/xmlWks/SBPqO-2019/recebidoOriginal/RS.xml --RS001
-- /home/user/sandbox/xmlWks/SBPqO-2019/recebidoOriginal/TCC.xml --TCC001

Node names: Resumo; Sigla; Titulo; Autores; Universidade; Email; Conclusao; Apoio.
```

Node paths: 
* /Resumos/Resumo[]; 
* /Resumos/Resumo[]/Sigla; 
* /Resumos/Resumo[]/Titulo; 
* /Resumos/Resumo[]/Autores; 
* /Resumos/Resumo[]/Universidade; 
* /Resumos/Resumo[]/Email; 
* /Resumos/Resumo[]/Resumo; 
* /Resumos/Resumo[]/Conclusao; 
* /Resumos/Resumo[]/Apoio

### Dump da Etapa 01b

Realizado o item 3 descrito acima. Resultados do item 3.1:

```
php src/proc.php etapa01b

-- etapa01b - Convertendo residuos XHTML do CDATA -- 
	-- AO.xml: AO0001 .. AO0240
	-- COL.xml: COL001 .. COL017
	-- FC.xml: FC001 .. FC030
	-- HA.xml: HA001 .. HA018
	-- JL.xml: JL001 .. JL003
	-- PDI.xml: PDI001 .. PDI002
	-- PE.xml: PE001 .. PE038
	-- PI.xml: PI0001 .. PI0920
	-- PN.xml: PN0001 .. PN1945
	-- PO.xml: PO001 .. PO045
	-- RS.xml: RS001 .. RS142
	-- TCC.xml: TCC001 .. TCC061
```

###  Dump e coment√°rios da Etapa 01c 
Realizada a opera√ß√£o descrita como item 3.3 acima, consistiu em rodar script em modo teste e modo produ√ß√£o. Rodando `php src/proc.php -test etapa01c > relatorio01c.txt`, resultados:

```
 -- etapa01c - Convertendo (e contando) entidades num√©ricas dos XMLs originais -- 
	AO.xml: 
		VERIFICAR: &#769; &#8203; &#257; &#119901;
		TOTAL 189 entities.
	COL.xml: 
		TOTAL 6 entities.
	FC.xml: 
		TOTAL 13 entities.
	HA.xml: 
		TOTAL 19 entities.
	JL.xml: 
		TOTAL 8 entities.
	PDI.xml: 
		TOTAL 0 entities.
	PE.xml: 
		VERIFICAR: &#807; &#771; &#769;
		TOTAL 11 entities.
	PI.xml: 
		VERIFICAR: &#771;  &#807; &#770; &#769; &#768; &#61617; &#8312; &#8315;
			   &#8202; &#8203; &#64257; &#776; &#720; &#713; &#8725;
		TOTAL 605 entities.
	PN.xml: 
		VERIFICAR: &#730; &#807;  &#771;  &#769; &#770; &#8722; &#646;  &#59154;
			   &#768; &#8206; &#8201; &#351; &#312; &#8208; &#8203; &#257;
			   &#8729; &#1178; &#411; &#8195; &#8202; &#8232; &#1455; &#713;
			   &#333; &#894;
		TOTAL 1430 entities.
	PO.xml: 
		TOTAL 2 entities.
	RS.xml: 
		VERIFICAR: &#8208; &#1008;
		TOTAL 12 entities.
	TCC.xml: 
		VERIFICAR: &#807; &#769;
		TOTAL 3 entities.
```

Depois das verifica√ß√µes manuais e inclus√£o dos diacrilicos na automa√ß√£o,
rodando de fato (sem option teste) `php src/proc.php etapa01c > relatorio01c.txt`. Resultados:

```
 -- etapa01c - Convertendo (e contando) entidades num√©ricas dos XMLs originais -- 
	AO.xml: 
		TOTAL 183 entities.
	COL.xml: 
		TOTAL 6 entities.
	FC.xml: 
		TOTAL 13 entities.
	HA.xml: 
		TOTAL 19 entities.
	JL.xml: 
		TOTAL 8 entities.
	PDI.xml: 
		TOTAL 0 entities.
	PE.xml: 
		TOTAL 1 entities.
	PI.xml: 
		TOTAL 498 entities.
	PN.xml: 
		VERIFICAR: &#257; &#411; &#894;
		TOTAL 1427 entities.
	PO.xml: 
		TOTAL 2 entities.
	RS.xml: 
		TOTAL 12 entities.
	TCC.xml: 
		TOTAL 3 entities.
```

Relat√≥rio de convers√£o e frequ√™ncia dos caracteres especiais, para eventuais verifica√ß√µes e decis√µes sobre normaliza√ß√£o:

 chr(257)=ƒÅ *2
 chr(312)=ƒ∏ *1
 chr(333)=≈ç *4
 chr(351)=≈ü *1
 chr(411)=∆õ *1
 chr(414)=∆û *2
 chr(593)=…ë *1
 chr(646)= Ü *1
 chr(706)=ÀÇ *12
 chr(707)=ÀÉ *5
 chr(713)=Àâ *2
 chr(720)=Àê *1
 chr(730)=Àö *4
 chr(768)=ÃÄ *13
 chr(769)=ÃÅ *146
 chr(770)=ÃÇ *39
 chr(771)=ÃÉ *113
 chr(776)=Ãà *2
 chr(807)=Ãß *85
 chr(894)=Õæ *4
 chr(916)=Œî *255
 chr(917)=Œï *1
 chr(922)=Œö *1
 chr(937)=Œ© *2
 chr(945)=Œ± *582
 chr(946)=Œ≤ *229
 chr(947)=Œ≥ *12
 chr(948)=Œ¥ *3
 chr(949)=Œµ *1
 chr(951)=Œ∑ *2
 chr(952)=Œ∏ *3
 chr(954)=Œ∫ *8
 chr(955)=Œª *5
 chr(956)=Œº *203
 chr(960)=œÄ *1
 chr(961)=œÅ *14
 chr(963)=œÉ *33
 chr(964)=œÑ *6
 chr(965)=œÖ *1
 chr(967)=œá *2
 chr(981)=œï *1
 chr(1008)=œ∞ *1
 chr(1178)=“ö *2
 chr(1455)=÷Ø *1
 chr(8195)=‚ÄÉ *1
 chr(8201)=‚Äâ *2
 chr(8202)=‚Ää *2
 chr(8203)=‚Äã *20
 chr(8206)=‚Äé *3
 chr(8208)=‚Äê *11
 chr(8232)=‚Ä® *2
 chr(8312)=‚Å∏ *2
 chr(8315)=‚Åª *1
 chr(8710)=‚àÜ *78
 chr(8722)=‚àí *2
 chr(8725)=‚àï *1
 chr(8729)=‚àô *1
 chr(8733)=‚àù *3
 chr(8773)=‚âÖ *5
 chr(8776)=‚âà *4
 chr(8800)=‚â† *1
 chr(8804)=‚â§ *173
 chr(8805)=‚â• *162
 chr(9082)=‚ç∫ *1
 chr(9651)=‚ñ≥ *2
 chr(59154)=Óúí *1
 chr(61617)=ÔÇ± *4
 chr(64257)=Ô¨Å *1
 chr(119901)=ùëù *1
 chr(120590)=ùúé *6


